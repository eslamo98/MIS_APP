<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <div class="mb-4">
                <h3 class="fw-bold mb-1 text-gradient">{{ t.TITLE[lang()] }}</h3>
                <p class="text-muted">{{ t.SUBTITLE[lang()] }}</p>
            </div>

            <app-dynamic-form-modal #formModal
                [isOpen]="isModalOpen()"
                [fields]="formFields"
                [gridSections]="gridConfig"
                [title]="modalTitle"
                [submitLabel]="submitLabel"
                (close)="isModalOpen.set(false)"
                (valueChanges)="onFormValueChange($event)"
                (submit)="onModalSubmit($event)">
            </app-dynamic-form-modal>

            <app-confirmation-modal
                [isOpen]="isConfirmOpen()"
                [title]="t.CONFIRM_DELETE_TITLE[lang()]"
                [message]="confirmMessage"
                (confirmed)="onDeleteConfirmed()"
                (cancelled)="isConfirmOpen.set(false)">
            </app-confirmation-modal>

            <app-confirmation-modal
                [isOpen]="isBulkConfirmOpen()"
                [title]="t.CONFIRM_BULK_TITLE[lang()]"
                [message]="bulkConfirmMessage"
                [confirmLabel]="t.CONFIRM_BULK_BTN[lang()]"
                [confirmIcon]="'magic'"
                [confirmVariant]="'success'"
                (confirmed)="onBulkInitConfirmed()"
                (cancelled)="isBulkConfirmOpen.set(false)">
            </app-confirmation-modal>

            <!-- Bulk Initialize Permissions Panel -->
            <div class="bulk-panel glass-card rounded-4 shadow-sm p-4 mb-4 animate-fade-in">
                <div class="d-flex align-items-start gap-3 mb-3">
                    <div class="bulk-icon-wrap rounded-3 d-flex align-items-center justify-content-center">
                        <i class="fas fa-shield-alt fa-lg"></i>
                    </div>
                    <div>
                        <h5 class="fw-bold mb-1">{{ t.BULK_INIT_TITLE[lang()] }}</h5>
                        <p class="text-muted small mb-0">{{ t.BULK_INIT_DESC[lang()] }}</p>
                    </div>
                </div>

                <div class="d-flex flex-column flex-md-row gap-3 align-items-end">
                    <div class="flex-grow-1">
                        <label class="form-label fw-bold small text-muted mb-1">{{ t.BOOTSTRAP_MODULE[lang()] }}</label>
                        <select id="bulkModuleSelect" class="form-select glass-input"
                            [ngModel]="selectedBulkModuleId()"
                            (ngModelChange)="selectedBulkModuleId.set($event)">
                            <option [ngValue]="null" disabled>{{ t.MODULE_CHOOSE[lang()] }}</option>
                            @for (m of moduleOptions; track m.key) {
                                <option [ngValue]="m.key">{{ m.value }}</option>
                            }
                        </select>
                    </div>
                    <button class="btn btn-initialize d-flex align-items-center gap-2 px-4 py-2"
                        [disabled]="!selectedBulkModuleId() || isBulkLoading()"
                        (click)="requestBulkInit()">
                        @if (isBulkLoading()) {
                            <div class="spinner-border spinner-border-sm"></div>
                        } @else {
                            <i class="fas fa-magic"></i>
                        }
                        <span>{{ isBulkLoading() ? t.BTN_INITIALIZING[lang()] : t.BTN_INITIALIZE[lang()] }}</span>
                    </button>
                </div>
            </div>

            <app-search-pane
                [fields]="searchFields"
                [gridSections]="searchGrid"
                [moduleName]="Modules.Roles"
                (search)="handleSearch($event)"
                (reset)="handleReset()"
                (create)="handleCreate()"
                (exportExcel)="handleExport('excel', $event)"
                (exportWord)="handleExport('word', $event)"
                (downloadPdf)="handleExport('pdf', $event)">
            </app-search-pane>

            <div class="bg-surface rounded-4 shadow-sm overflow-hidden animate-fade-in mt-4">
                <app-search-results
                    [data]="permissions()"
                    [columns]="columns"
                    [moduleName]="Modules.Roles"
                    [isPaged]="true"
                    [pagination]="pagination()"
                    (edit)="onEdit($event)"
                    (delete)="onDelete($event)"
                    (pageChange)="onPageChange($event)">
                </app-search-results>
            </div>
        </div>
    </div>
</div>
